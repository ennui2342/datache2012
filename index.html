<html>
<head>
<title>heatmap.js GMaps Heatmap Layer Demo</title>
		<style>
                        body, html {
				margin:0;
				padding:0;
				font-family:Arial;
			}
			h1 {
				margin-bottom:10px;
			}
			#main {
				position:relative;
				width:1020px;
				padding:20px;
				margin:auto;
			}
			#heatmapArea {
				position:relative;
				float:left;
				width:800px;
				height:600px;
				border:1px dashed black;
			}
			#configArea {
				position:relative;
				float:left;
				width:200px;
				padding:15px;
				padding-top:0;
				padding-right:0;
			}
			.btn {
				margin-top:25px;
				padding:10px 20px 10px 20px;
				-moz-border-radius:15px;
				-o-border-radius:15px;
				-webkit-border-radius:15px;
				border-radius:15px;
				border:2px solid black;
				cursor:pointer;
				color:white;
				background-color:black;
			}
			textarea{
				width:260px;
				padding:10px;
				height:200px;
			}
			h2{
				margin-top:0;
			}
		</style>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

</head>
<body>
<div id="main">
			<h1>GMaps Heatmap Overlay</h1>
			<div id="heatmapArea">
			
			</div>
			<div id="configArea">
				<div id="tog" class="btn">Toggle HeatmapOverlay</div>
			</div>
			
<div style="position:absolute;width:940px;top:750px;text-align:center;"><a href="http://www.patrick-wied.at/static/heatmapjs/">heatmap.js</a> by <a href="http://www.patrick-wied.at" target="_blank">Patrick Wied</a></div>

</div>
<script type="text/javascript" src="heatmap.js/src/heatmap.js"></script>
<script type="text/javascript" src="heatmap.js/src/heatmap-gmaps.js"></script>
<script type="text/javascript" src="4sq-checkins.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script type="text/javascript">

var map;
var heatmap; 

window.onload = function(){

//  var myLatlng = new google.maps.LatLng(48.3333, 16.35);
  var myLatlng = new google.maps.LatLng(52.200163, 0.120294);
	// sorry - this demo is a beta
	// there is lots of work todo
	// but I don't have enough time for eg redrawing on dragrelease right now
	var myOptions = {
	  zoom: 15,
	  center: myLatlng,
	  mapTypeId: google.maps.MapTypeId.ROADMAP,
	  disableDefaultUI: false,
	  scrollwheel: true,
	  draggable: true,
	  navigationControl: true,
	  mapTypeControl: false,
	  scaleControl: true,
	  disableDoubleClickZoom: false
	};
  map = new google.maps.Map(document.getElementById("heatmapArea"), myOptions);

  infowindow = new google.maps.InfoWindow(); 
	
      $.each(testData.data, function(i,v) {
        var marker = new google.maps.Marker({
          position: new google.maps.LatLng(v.lat,v.lng),
          map: map,
          title: v.name,
          data: {
            checkins: v.count,
            foursquare_id: v.foursquare_id
          }
        });

        // Listen for click event  
        google.maps.event.addListener(marker, 'click', function() { 
          map.setCenter(new google.maps.LatLng(marker.position.lat(), marker.position.lng())); 
          map.setZoom(15); 
          onItemClick(event, marker); 
        }); 

      });

      // Info window trigger function 
      function onItemClick(event, pin) { 
        // Create content  
        var info = $('<p>').append('<h1>' + pin.title + '</h1>' + pin.data.checkins + " checkins on foursquare<br/>"); 
        $.ajax({
          type: "GET",
          dataType: "jsonp",
          cache: false,
          url: "https://api.instagram.com/v1/locations/search?foursquare_v2_id=" + pin.data.foursquare_id + "&client_id=92dff618eebd4eb497f9ea08a42ac2da",
          success: function(data) {
            if(data.data.length > 0) {
              $.ajax({
                type: "GET",
                dataType: "jsonp",
                cache: false,
                url: "https://api.instagram.com/v1/locations/" + data.data[0].id + "/media/recent?client_id=92dff618eebd4eb497f9ea08a42ac2da",
                success: function(data) {
                  var c = data.data.length;
                  if (c > 12) {
                    c = 12;
                  }
                  for (var i = 0; i < c; i++) {
                    info.append("<a target='_blank' href='" + data.data[i].link + "'><img width=100 height=100 src='" + data.data[i].images.low_resolution.url +"'></img></a>");
                  }
                  infowindow.setContent(info.html()); 
                 infowindow.setPosition(pin.position); 
                 infowindow.open(map) 
                }
              });
            } else {
              infowindow.setContent(info.html()); 
              infowindow.setPosition(pin.position); 
              infowindow.open(map) 
            }
          },
          error: function(data) {
            infowindow.setContent(info.html()); 
            infowindow.setPosition(pin.position); 
            infowindow.open(map) 
          }
        });
      } 

	heatmap = new HeatmapOverlay(map, {"radius":15, "visible":true, "opacity":60});
	
	document.getElementById("tog").onclick = function(){
		heatmap.toggle();
	};

	
	// this is important, because if you set the data set too early, the latlng/pixel projection doesn't work
	google.maps.event.addListenerOnce(map, "idle", function(){
      heatmap.setDataSet(testData);
	});
};

</script>
<!-- Piwik -->

<script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://www.patrick-wied.at/helper/piwik/" : "http://www.patrick-wied.at/helper/piwik/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
    try {
            var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
            piwikTracker.trackPageView();
            piwikTracker.enableLinkTracking();
    } catch( err ) {}
</script><noscript><p><img src="http://www.patrick-wied.at/helper/piwik/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>
                                                                                                                    <!-- End Piwik Tag -->
</body>
</html>
